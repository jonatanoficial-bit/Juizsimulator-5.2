<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Jogo do Juiz 7.0 ‚Äî Vale Produ√ß√£o</title>
  <!-- React + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html,body,#root{height:100%;}
    body{
      margin:0;
      background:#000;
      color:#fff;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
const { useState, useEffect, useRef } = React;

// ---------------- DADOS FIXOS ----------------
const ESTADOS = {
  "AC":["Rio Branco"],"AL":["Macei√≥"],"AP":["Macap√°"],"AM":["Manaus"],
  "BA":["Salvador","Feira de Santana","Vit√≥ria da Conquista"],
  "CE":["Fortaleza"],"DF":["Bras√≠lia"],"ES":["Vit√≥ria"],"GO":["Goi√¢nia"],
  "MA":["S√£o Lu√≠s"],"MT":["Cuiab√°"],"MS":["Campo Grande"],
  "MG":["Belo Horizonte","Uberl√¢ndia","Juiz de Fora"],
  "PA":["Bel√©m"],"PB":["Jo√£o Pessoa"],"PR":["Curitiba","Londrina"],
  "PE":["Recife"],"PI":["Teresina"],"RJ":["Rio de Janeiro","Niter√≥i"],
  "RN":["Natal"],"RS":["Porto Alegre","Caxias do Sul"],
  "RO":["Porto Velho"],"RR":["Boa Vista"],
  "SC":["Florian√≥polis","Joinville"],
  "SP":["S√£o Paulo","Campinas","Santos","Sorocaba"],
  "SE":["Aracaju"],"TO":["Palmas"]
};

const SOUND_URLS = {
  gavel:"https://cdn.pixabay.com/download/audio/2022/03/15/audio_b8e7f6b3a0.mp3?filename=judge-gavel-182004.mp3",
  murmur:"https://cdn.pixabay.com/download/audio/2021/09/16/audio_7b4b2d7f6c.mp3?filename=crowd-murmur-ambient-75537.mp3"
};

function useSound(url, enabled=true, volume=0.7){
  const ref = useRef(null);
  useEffect(()=>{
    const a = new Audio(url);
    a.volume = volume;
    ref.current = a;
    return ()=>{ a.pause(); ref.current=null; };
  },[url]);
  const play = ()=>{ if(enabled && ref.current){ ref.current.currentTime=0; ref.current.play(); } };
  return { play };
}

function useTypewriter(fullText, speed=18){
  const [text,setText] = useState("");
  useEffect(()=>{
    if(!fullText){ setText(""); return; }
    let i=0;
    setText("");
    const id=setInterval(()=>{
      i++;
      setText(fullText.slice(0,i));
      if(i>=fullText.length) clearInterval(id);
    },speed);
    return ()=>clearInterval(id);
  },[fullText,speed]);
  return text;
}

// ------------- CASOS (BO + LAUDO + TESTEMUNHA) -------------
function seedCases(){
  const casos=[];
  let id=1;

  function addLote(tipo, modelos, repeticoes){
    modelos.forEach(m=>{
      for(let i=0;i<repeticoes;i++){
        casos.push({
          id: tipo+"-"+(id++),
          tipo,
          titulo: m.titulo+" #"+(i+1),
          resumo: m.resumo,
          gabarito: { culpado: m.culpado },
          provas: [
            {
              id:"E1",
              titulo:"Boletim de ocorr√™ncia",
              tipo:"boletim",
              conteudo:m.bo
            },
            {
              id:"E2",
              titulo:"Laudo pericial",
              tipo:"laudo",
              conteudo:m.laudo
            },
            {
              id:"E3",
              titulo:"Depoimento de testemunha",
              tipo:"testemunha",
              conteudo:m.testemunha
            }
          ],
          status:"na_fila"
        });
      }
    });
  }

  // Modelos CRIMINAIS
  const modelosCriminais = [
    {
      titulo:"Homic√≠dio simples em briga de bar",
      resumo:"Discuss√£o em estabelecimento que evolui para agress√µes f√≠sicas graves, culminando em morte de um dos envolvidos.",
      culpado:true,
      bo:"Consta no boletim de ocorr√™ncia que, por volta das 23h45, no interior do bar 'Esquina da Serra', houve discuss√£o acalorada entre v√≠tima e acusado, iniciada por desentendimento sobre pagamento de consuma√ß√£o. Testemunhas relataram empurr√µes m√∫tuos, arremesso de copos e gritos, at√© que o acusado sacou uma faca de cozinha e desferiu golpe √∫nico no t√≥rax da v√≠tima, que foi socorrida, mas n√£o resistiu aos ferimentos.",
      laudo:"O laudo de exame necrosc√≥pico descreve ferimento perfurocortante √∫nico em regi√£o tor√°cica esquerda, com trajet√≥ria de aproximadamente 12cm, atingindo pulm√£o e grandes vasos, sendo a causa da morte choque hipovol√™mico. N√£o foram identificados sinais de luta corporal intensa no corpo da v√≠tima, apenas escoria√ß√µes compat√≠veis com empurr√µes pr√©vios.",
      testemunha:"Eu estava sentado numa das mesas perto do balc√£o quando come√ßou a discuss√£o. Primeiro eles trocaram ofensas por causa da conta, depois se levantaram e come√ßaram a se empurrar. A v√≠tima tentou afastar o acusado, mas quem deu o passo pra frente foi o acusado. Eu vi quando ele puxou uma faca que estava perto da pia do bar e avan√ßou r√°pido, enfiando a l√¢mina no peito da v√≠tima. Tudo aconteceu em poucos segundos, n√£o deu tempo de ningu√©m separar."
    },
    {
      titulo:"Roubo em via p√∫blica",
      resumo:"Agente aborda v√≠tima em via p√∫blica, subtraindo celular com emprego de amea√ßa mediante simulacro de arma.",
      culpado:true,
      bo:"Segundo o boletim de ocorr√™ncia, a v√≠tima caminhava pela Rua das Palmeiras, por volta das 19h10, quando foi abordada por indiv√≠duo de capuz preto que colocou a m√£o sob a blusa, simulando portar arma de fogo, e exigiu a entrega do telefone celular. Ap√≥s receber o aparelho, o autor correu pela rua lateral, sendo acompanhado a dist√¢ncia por viatura que fora acionada por testemunha.",
      laudo:"O laudo de per√≠cia indireta em v√≠deo registra imagens de c√¢meras de seguran√ßa de com√©rcio local, nas quais se observa o exato momento da abordagem, a gesticula√ß√£o t√≠pica de amea√ßa e a fuga em dire√ß√£o √† viela. N√£o h√° identifica√ß√£o de arma de fogo real nas imagens, mas o simulacro utilizado foi apreendido em lixeira pr√≥xima, conforme relat√≥rio de apreens√£o.",
      testemunha:"Eu estava no ponto de √¥nibus quando vi o rapaz de capuz se aproximar da v√≠tima. Ele colocou a m√£o por baixo da blusa, apontando como se tivesse uma arma, e eu ouvi ele falar algo como 'passa o celular e n√£o reage'. A v√≠tima entregou o aparelho tremendo e o rapaz saiu correndo. Assim que ele dobrou a esquina, eu peguei o celular e liguei para a pol√≠cia, descrevendo a roupa e a dire√ß√£o da fuga."
    },
    {
      titulo:"Les√£o corporal em viol√™ncia dom√©stica",
      resumo:"Conflito entre casal em resid√™ncia, com alega√ß√£o de leg√≠tima defesa e hist√≥rico de agress√µes anteriores.",
      culpado:true,
      bo:"O boletim narra que vizinhos acionaram a pol√≠cia ap√≥s ouvirem gritos e barulhos de objetos sendo arremessados no apartamento 302. Ao chegar ao local, a equipe encontrou a v√≠tima chorando, com hematomas em bra√ßos e pesco√ßo, e o acusado em vis√≠vel estado de exalta√ß√£o, afirmando ter apenas se defendido. A v√≠tima relatou agress√µes anteriores, mas sem registro formal.",
      laudo:"O laudo de exame de corpo de delito aponta m√∫ltiplos hematomas em antebra√ßos, ombros e regi√£o cervical, compat√≠veis com agarr√µes fortes, al√©m de escoria√ß√µes em perna direita. As les√µes s√£o classificadas como de natureza leve, por√©m com n√≠tido padr√£o de repeti√ß√£o em diferentes est√°gios de cicatriza√ß√£o, sugerindo epis√≥dios anteriores.",
      testemunha:"Eu moro no apartamento ao lado e j√° ouvi brigas deles outras vezes, mas naquela noite foi diferente. A discuss√£o come√ßou com voz alta e xingamentos, depois ouvi barulho de porta batendo e m√≥veis arrastando. Pelas frestas, vi ele segurando os bra√ßos dela com for√ßa, enquanto ela pedia para ser solta. N√£o vi ela bater nele, s√≥ tentando afast√°-lo e se proteger."
    }
  ];

  // Modelos FAM√çLIA
  const modelosFamilia = [
    {
      titulo:"Revis√£o de alimentos",
      resumo:"Genitor requer redu√ß√£o de pens√£o aliment√≠cia em raz√£o de perda de emprego e novo filho em outro relacionamento.",
      culpado:false,
      bo:"N√£o h√° boletim de ocorr√™ncia neste caso, mas constam nos autos comprovantes de rescis√£o contratual do genitor, extratos banc√°rios recentes e certid√£o de nascimento de novo filho, indicando altera√ß√£o significativa na capacidade financeira.",
      laudo:"O relat√≥rio socioecon√¥mico elaborado pela equipe t√©cnica do ju√≠zo analisa a renda atual do alimentante, seus gastos essenciais, a exist√™ncia de nova prole e as necessidades b√°sicas da crian√ßa alimentanda, recomendando ajuste proporcional do valor sem comprometer o m√≠nimo existencial de nenhum dos dependentes.",
      testemunha:"Eu sou irm√£ do alimentante e acompanhei de perto quando ele perdeu o emprego. Ele sempre pagou a pens√£o, √†s vezes at√© adiantado, mas depois que nasceu o outro filho e a rescis√£o acabou, ele come√ßou a recorrer a bicos para garantir tudo. Mesmo assim, nunca vi ele se negar a ajudar a primeira crian√ßa; o problema √© que o valor fixado ficou pesado para a realidade nova."
    },
    {
      titulo:"Guarda compartilhada",
      resumo:"Pais discutem resid√™ncia principal da crian√ßa e regime de conviv√™ncia, ambos aptos e envolvidos na cria√ß√£o.",
      culpado:false,
      bo:"N√£o h√° registro policial. Consta peti√ß√£o inicial e contesta√ß√£o com relatos de ambos os genitores, indicando boa vincula√ß√£o afetiva, participa√ß√£o ativa na rotina escolar e aus√™ncia de epis√≥dios graves de viol√™ncia.",
      laudo:"O relat√≥rio psicol√≥gico conclui que a crian√ßa apresenta v√≠nculo seguro com ambos os pais, boa adapta√ß√£o escolar e desejo de manter contato frequente com pai e m√£e. Recomenda-se guarda compartilhada com resid√™ncia fixa em ambiente que preserve a rotina escolar e proximidade com a rede de apoio.",
      testemunha:"Eu sou professora da crian√ßa h√° dois anos e percebo que tanto a m√£e quanto o pai participam das reuni√µes, ajudam nos trabalhos e respondem √†s nossas mensagens. A crian√ßa fala com carinho dos dois e sempre conta que passa fins de semana alternados com o pai, parecendo bem adaptada a essa din√¢mica."
    },
    {
      titulo:"Regulamenta√ß√£o de visitas com medida protetiva",
      resumo:"Hist√≥rico de conflitos intensos gera medida protetiva; discute-se visitas supervisionadas em espa√ßo neutro.",
      culpado:false,
      bo:"Constam nos autos boletins de ocorr√™ncia anteriores relatando discuss√µes acaloradas na entrega e retirada da crian√ßa, inclusive na presen√ßa da menor, motivo pelo qual foi deferida medida protetiva de urg√™ncia, proibindo aproxima√ß√£o f√≠sica entre os genitores.",
      laudo:"O relat√≥rio da equipe t√©cnica aponta que a crian√ßa demonstra ansiedade em dias de visita, mas mant√©m v√≠nculo afetivo com o genitor n√£o guardi√£o. Recomenda-se manuten√ß√£o do contato, por√©m em ambiente supervisionado e preparado para visitas assistidas, evitando novas situa√ß√µes de conflito direto entre os adultos.",
      testemunha:"Eu trabalho na portaria do condom√≠nio e presenciei algumas das entregas da crian√ßa. Em mais de uma ocasi√£o, os dois come√ßaram a discutir alto, um acusando o outro de chegar atrasado ou de n√£o cumprir combinados. A menina ficava no meio, visivelmente assustada, segurando a mochila com for√ßa. Nunca vi o pai agredir a crian√ßa, mas as brigas entre eles eram frequentes."
    }
  ];

  // Modelos TRABALHISTA
  const modelosTrabalhista = [
    {
      titulo:"Horas extras habituais",
      resumo:"Empregado alega jornada di√°ria superior √† contratual sem o devido pagamento de horas extras e reflexos.",
      culpado:false,
      bo:"Nos documentos juntados, constam cart√µes de ponto que indicam sa√≠das recorrentes ap√≥s o hor√°rio contratual, com marca√ß√µes muitas vezes compensadas em banco de horas, sem indica√ß√£o clara de pagamento de adicional de horas extras.",
      laudo:"O laudo cont√°bil trabalhista apresentado pelo perito judicial reconstitui a jornada com base em cart√µes de ponto, depoimentos e documentos internos, apontando diferen√ßas entre a jornada registrada e a efetivamente cumprida, com sugest√£o de c√°lculo de horas extras devidas.",
      testemunha:"Eu trabalhei no mesmo setor que o reclamante e, na pr√°tica, a gente quase sempre sa√≠a mais tarde do que o registrado. O supervisor orientava a bater o ponto no hor√°rio e depois voltar para terminar as demandas do dia. O banco de horas at√© existia, mas era dif√≠cil conseguir folga em troca, porque o setor vivia sobrecarregado."
    },
    {
      titulo:"V√≠nculo de emprego X PJ",
      resumo:"Trabalhador contratado como pessoa jur√≠dica afirma subordina√ß√£o, habitualidade, pessoalidade e onerosidade.",
      culpado:false,
      bo:"Constam nos autos contratos de presta√ß√£o de servi√ßos emitidos em nome da pessoa jur√≠dica do reclamante, com cl√°usula de exclusividade e previs√£o de presta√ß√£o cont√≠nua de servi√ßos em favor da reclamada.",
      laudo:"O laudo pericial analisa e-mails, registros de ponto eletr√¥nico interno e instrumentos contratuais, concluindo que o reclamante cumpria jornada fixa, recebia ordens diretas de gestores da empresa e n√£o tinha autonomia para enviar substitutos, caracter√≠sticas t√≠picas de rela√ß√£o de emprego.",
      testemunha:"Eu tamb√©m fui contratado como PJ pela mesma empresa. Apesar do contrato dizer que √©ramos prestadores de servi√ßo, na pr√°tica t√≠nhamos hora exata para entrar e sair, metas semanais impostas pelo gerente e n√£o pod√≠amos mandar outra pessoa no nosso lugar. Se falt√°ssemos, era tratado como falta normal de funcion√°rio."
    },
    {
      titulo:"Ass√©dio moral no ambiente de trabalho",
      resumo:"Supervisor dirige reiteradas humilha√ß√µes em p√∫blico, alegando apenas cobran√ßa por desempenho.",
      culpado:false,
      bo:"Foram juntadas reclama√ß√µes formais ao RH e prints de conversas em grupo corporativo, em que o supervisor utiliza express√µes pejorativas e exp√µe metas e falhas dos empregados de forma vexat√≥ria.",
      laudo:"O laudo psicol√≥gico ocupacional indica que o reclamante apresenta sintomas de ansiedade, ins√¥nia e queda de autoestima, com nexo temporal entre o in√≠cio do quadro e o aumento de epis√≥dios de humilha√ß√£o no ambiente de trabalho.",
      testemunha:"Eu fazia parte do mesmo grupo de mensagens e cansei de ver o supervisor chamando o reclamante de 'in√∫til' e 'peso morto' na frente de todo mundo. Nas reuni√µes presenciais, ele levantava gr√°ficos na tela e apontava o nome do reclamante, dizendo que era o pior do time. Isso acontecia quase toda semana."
    }
  ];

  // Gera cerca de 100 casos por ramo (3 modelos x ~12 repeti√ß√µes = 36, aqui uso 10 p/ n√£o ficar pesado demais)
  addLote("criminal",modelosCriminais,10);
  addLote("familia",modelosFamilia,10);
  addLote("trabalhista",modelosTrabalhista,10);

  return casos;
}

// -------- IA SIMULADA (acusa√ß√£o, defesa, testemunha) --------
async function iaFala(agente, caso, pergunta=""){
  const resumo = caso.resumo;

  // An√°lise simples da pergunta para parecer mais "inteligente"
  let focoPergunta = "";
  const p = pergunta.toLowerCase();
  if(p.includes("hora") || p.includes("hor√°rio")) focoPergunta = "Quanto ao hor√°rio dos fatos, ";
  else if(p.includes("local") || p.includes("onde")) focoPergunta = "Sobre o local exato do ocorrido, ";
  else if(p.includes("arma") || p.includes("faca") || p.includes("rev√≥lver")) focoPergunta = "Em rela√ß√£o √† arma utilizada, ";
  else if(p.includes("les√£o") || p.includes("ferimento") || p.includes("hematoma")) focoPergunta = "Com rela√ß√£o √†s les√µes observadas, ";
  else if(p.includes("testemunha") || p.includes("viu") || p.includes("presenciou")) focoPergunta = "Acerca do que foi percebido diretamente, ";
  else if(p.includes("motivo") || p.includes("inten√ß√£o") || p.includes("discuss√£o")) focoPergunta = "No tocante ao motivo e √† din√¢mica da discuss√£o, ";

  // Testemunha: fala em primeira pessoa com base na prova
  if(agente==="testemunha"){
    const provaTest = caso.provas.find(p=>p.tipo==="testemunha");
    const baseTexto = provaTest ? provaTest.conteudo : resumo;
    const prefixoPerg = pergunta
      ? focoPergunta + "respondendo √† pergunta do Juiz, posso dizer: "
      : "Vou relatar com detalhes o que eu vi naquele dia: ";
    const texto = "TESTEMUNHA ‚Äî " + prefixoPerg + baseTexto;
    await new Promise(r=>setTimeout(r,300));
    return texto;
  }

  const prefixo =
    agente==="acusacao" ? "ACUSA√á√ÉO ‚Äî " :
    agente==="defesa" ? "DEFESA ‚Äî " :
    "TESTEMUNHA ‚Äî ";

  const foco = pergunta
    ? focoPergunta + 'respondendo √† pergunta do Juiz: "'+pergunta+'". '
    : "Expondo os principais pontos do processo. ";

  const base =
    agente==="acusacao"
      ? "A acusa√ß√£o destaca a coer√™ncia das provas documentais, periciais e testemunhais, defendendo a responsabiliza√ß√£o do r√©u dentro do padr√£o de prova exigido. "
      : agente==="defesa"
        ? "A defesa enfatiza contradi√ß√µes, lacunas probat√≥rias e o princ√≠pio do in dubio pro reo, apontando caminhos interpretativos que afastam a condena√ß√£o. "
        : "A testemunha descreve o que percebeu direta ou indiretamente, ajudando a reconstruir o contexto f√°tico. ";

  const texto = prefixo + foco + base + "Resumo do caso: " + resumo;
  await new Promise(r=>setTimeout(r,300));
  return texto;
}

// ---------------- TELAS B√ÅSICAS ----------------
function SplashScreen({onStart}){
  return (
    <div className="min-h-screen flex items-center justify-center bg-black">
      <div className="relative w-full max-w-md h-[520px] rounded-3xl overflow-hidden shadow-2xl">
        <div
          className="absolute inset-0 bg-cover bg-center"
          style={{backgroundImage:"url('capa.jpg')"}}
        />
        <div className="absolute inset-0 bg-gradient-to-t from-black via-black/70 to-transparent" />
        <div className="relative z-10 h-full flex flex-col items-center justify-end pb-10 px-6">
          <h1 className="text-3xl font-bold mb-1 drop-shadow-lg text-center">Jogo do Juiz 7.0</h1>
          <p className="text-sm opacity-90 mb-4 text-center">Vale Produ√ß√£o ‚Ä¢ Simulador Jur√≠dico</p>
          <button
            onClick={onStart}
            className="px-6 py-3 rounded-2xl bg-emerald-500 hover:bg-emerald-600 text-sm font-semibold shadow-xl"
          >
            Iniciar
          </button>
        </div>
      </div>
    </div>
  );
}

function TutorialSalvamento({onContinuar}){
  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-b from-slate-950 via-slate-900 to-black text-white">
      <div className="max-w-xl w-full mx-4 p-6 rounded-3xl bg-white/5 border border-white/10 backdrop-blur">
        <h2 className="text-2xl font-bold mb-3">Como o jogo salva seu progresso</h2>
        <ol className="list-decimal pl-5 space-y-2 text-sm">
          <li>O jogo grava automaticamente sua carreira no pr√≥prio navegador (localStorage).</li>
          <li>Voc√™ pode exportar um arquivo de backup (.json) pela tela de login.</li>
          <li>Depois, pode importar esse arquivo em outro dispositivo e continuar do ponto em que parou.</li>
        </ol>
        <p className="mt-4 text-xs opacity-80">
          Dica: use um nome de usu√°rio fixo (ex.: <b>DraMaria</b>) para manter sua carreira organizada.
        </p>
        <button
          onClick={onContinuar}
          className="mt-5 px-5 py-2 rounded-2xl bg-emerald-500 hover:bg-emerald-600 text-sm font-semibold"
        >
          Entendi, ir para o login
        </button>
      </div>
    </div>
  );
}

function LoginScreen({profiles,setProfiles,setCurrentProfile,onEnter}){
  const [user,setUser] = useState("");
  const [file,setFile] = useState(null);

  function handleEnter(){
    if(!user.trim()) return;
    if(!profiles[user]){
      const novo = {
        nome:user.trim(),
        court:null,
        estado:"SP",
        cidade:"S√£o Paulo",
        avatar:null,
        stats:{julgados:0,acertos:0,prestigio:0}
      };
      const updated = {...profiles,[user]:novo};
      setProfiles(updated);
      localStorage.setItem("juiz_profiles",JSON.stringify(updated));
    }
    setCurrentProfile(user.trim());
    onEnter();
  }

  function handleExport(){
    const blob = new Blob([JSON.stringify(profiles,null,2)],{type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href=url;
    a.download="jogo-do-juiz-save.json";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  function handleImport(){
    if(!file) return;
    const reader = new FileReader();
    reader.onload = e=>{
      try{
        const data = JSON.parse(e.target.result);
        setProfiles(data);
        localStorage.setItem("juiz_profiles",JSON.stringify(data));
        alert("Save importado com sucesso!");
      }catch(err){
        alert("Arquivo inv√°lido.");
      }
    };
    reader.readAsText(file);
  }

  return (
    <div
      className="min-h-screen bg-cover bg-center flex items-center justify-center"
      style={{backgroundImage:"url('capa.jpg')"}}
    >
      <div className="bg-black/80 text-white max-w-lg w-full mx-4 p-6 rounded-3xl border border-white/10 backdrop-blur">
        <h1 className="text-xl font-semibold mb-1 text-center">Vale Produ√ß√£o apresenta</h1>
        <h2 className="text-3xl font-bold text-center mb-4">Jogo do Juiz</h2>
        <p className="text-xs text-center mb-4 opacity-80">
          Crie seu usu√°rio ou escolha um j√° existente. Exporte/importe seu progresso quando quiser.
        </p>

        <div className="space-y-3">
          <div>
            <label className="text-xs opacity-80">Usu√°rio</label>
            <input
              className="w-full mt-1 px-3 py-2 rounded-xl bg-white/10 outline-none text-sm"
              value={user}
              onChange={e=>setUser(e.target.value)}
              placeholder="Ex.: DraMaria, EstudanteJo√£o..."
            />
          </div>

          <div className="flex gap-2">
            <button
              onClick={handleEnter}
              className="flex-1 px-3 py-2 rounded-xl bg-emerald-500 hover:bg-emerald-600 text-sm font-semibold"
            >
              Entrar / Criar perfil
            </button>
            <button
              onClick={handleExport}
              className="px-3 py-2 rounded-xl bg-white/10 hover:bg-white/20 text-xs"
            >
              Exportar save
            </button>
          </div>

          <div className="mt-2 text-xs">
            <div className="mb-1">Importar save:</div>
            <input
              type="file"
              accept=".json"
              onChange={e=>setFile(e.target.files[0]||null)}
              className="text-xs"
            />
            <button
              onClick={handleImport}
              className="ml-2 px-3 py-1 rounded-xl bg-sky-500 hover:bg-sky-600 text-xs"
            >
              Importar
            </button>
          </div>
        </div>

        {Object.keys(profiles).length>0 && (
          <div className="mt-4">
            <div className="text-xs mb-1 opacity-70">Perfis:</div>
            <div className="flex flex-wrap gap-2">
              {Object.keys(profiles).map(p=>(
                <button
                  key={p}
                  onClick={()=>setUser(p)}
                  className="px-3 py-1 rounded-full bg-white/10 hover:bg-white/20 text-xs"
                >
                  {p}
                </button>
              ))}
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

// --------- Escolha de avatar do juiz (6 imagens) ---------
function AvatarSelectScreen({profile,onSelectAvatar}){
  const avatars = [
    "avatar1.jpg","avatar2.jpg","avatar3.jpg",
    "avatar4.jpg","avatar5.jpg","avatar6.jpg"
  ];
  const [selected,setSelected] = useState(profile.avatar || avatars[0]);

  return (
    <div className="min-h-screen flex items-center justify-center bg-black text-white">
      <div className="max-w-4xl w-full mx-4 p-6">
        <h2 className="text-2xl font-bold mb-1 text-center">Escolha seu avatar</h2>
        <p className="text-xs opacity-80 mb-4 text-center">
          Este ser√° o retrato oficial que aparecer√° no escrit√≥rio e nos relat√≥rios.
        </p>
        <div className="grid grid-cols-2 md:grid-cols-3 gap-5 mb-4">
          {avatars.map(a=>(
            <button
              key={a}
              onClick={()=>setSelected(a)}
              className={
                "rounded-3xl overflow-hidden border-2 " +
                (selected===a ? "border-emerald-400" : "border-transparent")
              }
            >
              <img src={a} alt={a} className="w-full h-40 object-cover" />
            </button>
          ))}
        </div>
        <button
          onClick={()=>onSelectAvatar(selected)}
          className="mt-2 px-5 py-2 rounded-2xl bg-emerald-500 hover:bg-emerald-600 text-sm font-semibold block mx-auto"
        >
          Confirmar avatar
        </button>
      </div>
    </div>
  );
}

// -------- Sele√ß√£o de tribunal / local --------
function CourtSelectScreen({onSelectCourt}){
  const courts = [
    {id:"criminal",icon:"‚öñÔ∏è",nome:"Criminal",desc:"Crimes contra a pessoa e o patrim√¥nio."},
    {id:"familia",icon:"üë®‚Äçüë©‚Äçüëß",nome:"Fam√≠lia",desc:"Guarda, pens√£o, div√≥rcio e medidas protetivas."},
    {id:"trabalhista",icon:"üíº",nome:"Trabalhista",desc:"V√≠nculo, verbas, jornada e danos morais."}
  ];
  return (
    <div className="min-h-screen bg-black flex items-center justify-center text-white">
      <div className="max-w-4xl w-full mx-4 p-6">
        <h2 className="text-3xl font-bold mb-6 text-center">Escolha o Tribunal</h2>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-5">
          {courts.map(c=>(
            <button
              key={c.id}
              onClick={()=>onSelectCourt(c.id)}
              className="p-5 rounded-3xl bg-white/10 border border-white/15 hover:bg-white/20 transition text-left"
            >
              <div className="text-3xl mb-2">{c.icon}</div>
              <div className="text-lg font-semibold">{c.nome}</div>
              <p className="text-xs opacity-80 mt-1">{c.desc}</p>
            </button>
          ))}
        </div>
      </div>
    </div>
  );
}

function LocationSelect({profile,onSelectLocation}){
  const [estado,setEstado] = useState(profile.estado||"SP");
  const cidades = ESTADOS[estado] || [];
  const [cidade,setCidade] = useState(profile.cidade||cidades[0]||"");

  return (
    <div className="min-h-screen bg-black text-white flex items-center justify-center">
      <div className="bg-white/10 p-6 rounded-3xl max-w-md w-full mx-4 border border-white/10">
        <h2 className="text-2xl font-bold mb-4">Escolha a comarca</h2>
        <div className="mb-3">
          <label className="text-xs opacity-80">Estado</label>
          <select
            value={estado}
            onChange={e=>{
              const uf = e.target.value;
              setEstado(uf);
              const lista = ESTADOS[uf]||[];
              setCidade(lista[0]||"");
            }}
            className="w-full mt-1 px-3 py-2 bg-white/10 rounded-xl outline-none text-sm"
          >
            {Object.keys(ESTADOS).map(uf=>(
              <option key={uf} value={uf}>{uf}</option>
            ))}
          </select>
        </div>
        <div className="mb-4">
          <label className="text-xs opacity-80">Cidade</label>
          <select
            value={cidade}
            onChange={e=>setCidade(e.target.value)}
            className="w-full mt-1 px-3 py-2 bg-white/10 rounded-xl outline-none text-sm"
          >
            {(ESTADOS[estado]||[]).map(c=>(
              <option key={c} value={c}>{c}</option>
            ))}
          </select>
        </div>
        <button
          onClick={()=>onSelectLocation(estado,cidade)}
          className="w-full px-4 py-2 rounded-xl bg-emerald-500 hover:bg-emerald-600 text-sm font-semibold"
        >
          Confirmar
        </button>
      </div>
    </div>
  );
}

// -------- Visualiza√ß√£o de PROVA com fundo por tipo --------
function ProvaViewer({prova,onClose}){
  if(!prova) return null;

  let bg = "boletim.jpg";
  if(prova.tipo==="laudo") bg="laudo.jpg";
  if(prova.tipo==="testemunha") bg="testemunha.jpg";

  return (
    <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-40">
      <div
        className="bg-slate-900 border border-white/15 rounded-3xl max-w-lg w-full mx-4 p-6 relative overflow-hidden"
      >
        <div
          className="absolute inset-0 opacity-20 bg-cover bg-center"
          style={{backgroundImage:`url('${bg}')`}}
        ></div>
        <div className="relative z-10">
          <h3 className="text-lg font-semibold mb-2">{prova.titulo}</h3>
          <p className="text-sm whitespace-pre-wrap opacity-90 mb-4">{prova.conteudo}</p>
          <button
            onClick={onClose}
            className="px-4 py-2 rounded-xl bg-red-500 hover:bg-red-600 text-sm font-semibold"
          >
            Fechar
          </button>
        </div>
      </div>
    </div>
  );
}

// -------- Relat√≥rio Semestral --------
function RelatorioSemestral({profile,cases,onVoltar}){
  const stats = profile.stats || { julgados: 0, acertos: 0, prestigio: 0 };

  const julgadosTribunal = cases.filter(c =>
    (c.status === "condenado" || c.status === "absolvido") &&
    (!profile.court || c.tipo === profile.court)
  );

  const condenacoes = julgadosTribunal.filter(c => c.status === "condenado").length;
  const absolucoes  = julgadosTribunal.filter(c => c.status === "absolvido").length;

  const taxaAcerto = stats.julgados
    ? Math.round((stats.acertos / stats.julgados) * 100)
    : 0;

  return (
    <div
      className="min-h-screen relative text-white"
      style={{
        backgroundImage: "url('escritorio.jpg')",
        backgroundSize: "cover",
        backgroundPosition: "center"
      }}
    >
      <div className="absolute inset-0 bg-black/80 backdrop-blur-sm"></div>
      <div className="relative z-10 max-w-3xl mx-auto p-6">
        <button
          onClick={onVoltar}
          className="mb-4 px-3 py-1 rounded-xl bg-white/10 hover:bg-white/20 text-xs"
        >
          Voltar ao escrit√≥rio
        </button>

        <div className="bg-white/10 border border-white/15 rounded-3xl p-5 flex flex-col md:flex-row gap-5">
          <div className="flex flex-col items-center md:w-1/3">
            {profile.avatar && (
              <img
                src={profile.avatar}
                alt="Avatar do juiz"
                className="w-24 h-24 rounded-full border border-white/40 object-cover mb-3"
              />
            )}
            <div className="text-center text-sm">
              <div className="font-semibold">{profile.nome}</div>
              <div className="text-[11px] opacity-80">
                {profile.cidade}/{profile.estado}
              </div>
              <div className="text-[11px] opacity-80 mt-1">
                Tribunal: {profile.court ? profile.court.toUpperCase() : "n√£o definido"}
              </div>
            </div>
          </div>

          <div className="flex-1 text-sm">
            <h2 className="text-lg font-semibold mb-2">
              Relat√≥rio estat√≠stico semestral
            </h2>
            <p className="text-[11px] opacity-80 mb-3">
              Dados resumidos do desempenho do juiz neste per√≠odo simulado.
            </p>

            <div className="grid grid-cols-2 gap-3 mb-4">
              <div className="bg-black/30 rounded-2xl p-3">
                <div className="text-[11px] opacity-70">Casos julgados</div>
                <div className="text-xl font-bold">{stats.julgados}</div>
              </div>
              <div className="bg-black/30 rounded-2xl p-3">
                <div className="text-[11px] opacity-70">Acertos (gabarito)</div>
                <div className="text-xl font-bold">{stats.acertos}</div>
                <div className="text-[11px] opacity-70">
                  Taxa de acerto: {taxaAcerto}%
                </div>
              </div>
              <div className="bg-black/30 rounded-2xl p-3">
                <div className="text-[11px] opacity-70">Condena√ß√µes</div>
                <div className="text-xl font-bold">{condenacoes}</div>
              </div>
              <div className="bg-black/30 rounded-2xl p-3">
                <div className="text-[11px] opacity-70">Absolvi√ß√µes</div>
                <div className="text-xl font-bold">{absolucoes}</div>
              </div>
            </div>

            <div className="bg-black/30 rounded-2xl p-3 text-[11px] space-y-1">
              <div className="font-semibold mb-1">Leitura pedag√≥gica:</div>
              <p>
                ‚Ä¢ Um n√∫mero equilibrado de condena√ß√µes e absolvi√ß√µes indica
                aten√ß√£o ao conjunto probat√≥rio, e n√£o apenas √† acusa√ß√£o.
              </p>
              <p>
                ‚Ä¢ A taxa de acerto mostra o quanto suas decis√µes se alinham ao
                gabarito desta simula√ß√£o. Use esse √≠ndice para identificar
                oportunidades de estudo.
              </p>
              <p>
                ‚Ä¢ O prest√≠gio atual do juiz √© de{" "}
                <b>{stats.prestigio}%</b>. Prest√≠gio mais alto representa
                consist√™ncia, fundamenta√ß√£o e coer√™ncia nas decis√µes.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

// -------- Escrit√≥rio --------
function Escritorio({profile,cases,onSelectCase,onSTJ,onRelatorio,sons,mode,setMode}){
  const fila = cases.filter(c=>c.status==="na_fila" && (!profile.court || c.tipo===profile.court));

  return (
    <div
      className="min-h-screen relative text-white"
      style={{
        backgroundImage:"url('escritorio.jpg')",
        backgroundSize:"cover",
        backgroundPosition:"center"
      }}
    >
      <div className="absolute inset-0 bg-black/65 backdrop-blur-sm"></div>
      <div className="relative z-10 max-w-6xl mx-auto p-6">
        <div className="flex items-center justify-between mb-4">
          <div className="flex items-center gap-3">
            {profile.avatar && (
              <img
                src={profile.avatar}
                alt="avatar"
                className="w-12 h-12 rounded-full border border-white/50 object-cover"
              />
            )}
            <div>
              <h1 className="text-2xl font-bold">Escrit√≥rio do Juiz</h1>
              <p className="text-xs opacity-80">
                {profile.nome} ‚Äî {profile.cidade}/{profile.estado} ‚Ä¢ {profile.court||"sem tribunal"}
              </p>
            </div>
          </div>
          <div className="text-xs text-right opacity-80">
            Julgados: {profile.stats?.julgados||0}<br/>
            Acertos: {profile.stats?.acertos||0}<br/>
            Prest√≠gio: {profile.stats?.prestigio||0}
          </div>
        </div>

        <div className="mb-4 flex items-center gap-2 text-xs">
          <span className="opacity-80 mr-1">Modo:</span>
          <button
            onClick={()=>setMode("carreira")}
            className={
              "px-3 py-1 rounded-full border " +
              (mode==="carreira"
                ? "bg-emerald-500 border-emerald-300"
                : "bg-white/10 border-white/20")
            }
          >
            Carreira
          </button>
          <button
            onClick={()=>setMode("estudo")}
            className={
              "px-3 py-1 rounded-full border " +
              (mode==="estudo"
                ? "bg-sky-500 border-sky-300"
                : "bg-white/10 border-white/20")
            }
          >
            Estudo
          </button>
          <span className="opacity-70 ml-2">
            {mode==="carreira"
              ? "Decis√µes contam para o prest√≠gio."
              : "Decis√µes n√£o alteram estat√≠sticas oficiais."}
          </span>
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div className="bg-white/10 border border-white/10 rounded-3xl p-5">
            <h2 className="text-lg font-semibold mb-3">Fila de processos</h2>
            <div className="max-h-96 overflow-y-auto space-y-3 pr-2">
              {fila.length===0 && (
                <p className="text-xs opacity-70">Nenhum processo na fila para este tribunal.</p>
              )}
              {fila.map(c=>(
                <div key={c.id} className="p-3 rounded-2xl bg-white/5 border border-white/10">
                  <h3 className="text-sm font-semibold mb-1">{c.titulo}</h3>
                  <p className="text-xs opacity-80 mb-2">{c.resumo}</p>
                  <button
                    onClick={()=>{sons.gavel.play();onSelectCase(c.id);}}
                    className="px-3 py-1 rounded-xl bg-emerald-500 hover:bg-emerald-600 text-xs font-semibold"
                  >
                    Iniciar julgamento
                  </button>
                </div>
              ))}
            </div>
          </div>

          <div className="bg-white/10 border border-white/10 rounded-3xl p-5 flex flex-col">
            <h2 className="text-lg font-semibold mb-3">Painel da carreira</h2>
            <p className="text-xs opacity-80 mb-3">
              Acompanhe sua evolu√ß√£o e acesse relat√≥rios para estudo e aprimoramento.
            </p>
            <button
              onClick={onRelatorio}
              className="mb-2 w-full px-4 py-2 rounded-xl bg-sky-500 hover:bg-sky-600 text-sm font-semibold"
            >
              Ver relat√≥rio semestral
            </button>
            {(profile.stats?.prestigio||0) >= 40 && mode==="carreira" && (
              <button
                onClick={onSTJ}
                className="w-full px-4 py-2 rounded-xl bg-yellow-500 hover:bg-yellow-600 text-sm font-semibold mt-2"
              >
                Candidatar-se ao STJ
              </button>
            )}
            <div className="mt-4 text-[10px] opacity-70">
              Simula√ß√£o educacional inspirada em rotinas reais, sem valor jur√≠dico.
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

// -------- Julgamento --------
function Julgamento({caso,onAtualizarCaso,onVoltar,profile,sons,mode}){
  const [falas,setFalas] = useState([]);
  const [pergunta,setPergunta] = useState("");
  const [provaSel,setProvaSel] = useState(null);
  const [acusacaoText,setAcusacaoText] = useState("");
  const [defesaText,setDefesaText] = useState("");
  const typedAcus = useTypewriter(acusacaoText,14);
  const typedDef = useTypewriter(defesaText,14);

  const [jurados,setJurados] = useState(
    ()=>Array.from({length:12},(_,i)=>({id:i+1,voto:null,certeza:0}))
  );
  const jurorAvatars = Array.from({length:12},(_,i)=>`juri${i+1}.jpg`);

  async function ouvir(ag){
    const fala = await iaFala(ag,caso,"");
    if(ag==="acusacao"){
      setAcusacaoText(fala);
    }else if(ag==="defesa"){
      setDefesaText(fala);
    }else{
      setFalas(f=>[...f,{autor:"testemunha",texto:fala}]);
    }
    sons.murmur.play();
  }

  async function perguntarIA(){
    if(!pergunta.trim()) return;
    const fala = await iaFala("testemunha",caso,pergunta);
    setFalas(f=>[
      ...f,
      {autor:"juiz",texto:"Pergunta do Juiz: "+pergunta},
      {autor:"testemunha",texto:fala}
    ]);
    setPergunta("");
    sons.murmur.play();
  }

  function simularJuri(){
    if(caso.tipo!=="criminal"){
      alert("Este caso n√£o possui j√∫ri popular nesta simula√ß√£o. J√∫ri popular √© reservado a crimes dolosos contra a vida.");
      return;
    }
    const novo = jurados.map(j=>{
      const voto = Math.random()<0.6; // leve vi√©s para condenar
      const certeza = 60 + Math.round(Math.random()*40);
      return {...j,voto,certeza};
    });
    setJurados(novo);
    sons.murmur.play();
  }

  function decidir(veredito){
    const acertou = veredito===caso.gabarito.culpado;
    const novoStatus = veredito ? "condenado" : "absolvido";
    const atualizado = {...caso,status:novoStatus};
    onAtualizarCaso(atualizado,acertou,mode);
    if(mode==="carreira"){
      alert(acertou
        ? "Decis√£o coerente com o gabarito da simula√ß√£o. Seu prest√≠gio foi atualizado."
        : "Nesta simula√ß√£o, o gabarito apontava outra solu√ß√£o. Use o relat√≥rio para estudar os padr√µes.");
    }else{
      alert("Modo estudo: decis√£o registrada apenas para fins did√°ticos, sem alterar estat√≠sticas oficiais.");
    }
    onVoltar();
  }

  return (
    <div
      className="min-h-screen relative text-white"
      style={{
        backgroundImage:"url('saladejulgamento.jpg')",
        backgroundSize:"cover",
        backgroundPosition:"center"
      }}
    >
      <div className="absolute inset-0 bg-black/75 backdrop-blur-sm"></div>
      <ProvaViewer prova={provaSel} onClose={()=>setProvaSel(null)} />
      <div className="relative z-10 max-w-5xl mx-auto p-6">
        <button
          onClick={onVoltar}
          className="mb-4 px-3 py-1 rounded-xl bg-white/10 hover:bg-white/20 text-xs"
        >
          Voltar ao escrit√≥rio
        </button>
        <h1 className="text-2xl font-bold mb-1">{caso.titulo}</h1>
        <p className="text-xs opacity-80 mb-4">{caso.resumo}</p>

        <div className="flex items-center gap-4 mb-4">
          <div className="flex items-center gap-2">
            <img
              src="avatar-promotor.jpg"
              alt="Promotoria"
              className="w-10 h-10 rounded-full border border-red-300 object-cover"
            />
            <div className="text-xs">
              <div className="font-semibold text-red-300">Promotoria</div>
              <div className="opacity-70">Titular da a√ß√£o penal</div>
            </div>
          </div>
          <div className="flex items-center gap-2">
            <img
              src="avatar-defesa.jpg"
              alt="Defesa"
              className="w-10 h-10 rounded-full border border-emerald-300 object-cover"
            />
            <div className="text-xs">
              <div className="font-semibold text-emerald-300">Defesa</div>
              <div className="opacity-70">Advocacia / Defensoria</div>
            </div>
          </div>
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <div className="lg:col-span-2 space-y-3">
            <div className="flex flex-wrap gap-2 mb-1">
              <button
                onClick={()=>ouvir("acusacao")}
                className="px-3 py-1 rounded-xl bg-red-500 hover:bg-red-600 text-xs"
              >
                Ouvir Acusa√ß√£o
              </button>
              <button
                onClick={()=>ouvir("defesa")}
                className="px-3 py-1 rounded-xl bg-emerald-500 hover:bg-emerald-600 text-xs"
              >
                Ouvir Defesa
              </button>
              <button
                onClick={()=>ouvir("testemunha")}
                className="px-3 py-1 rounded-xl bg-sky-500 hover:bg-sky-600 text-xs"
              >
                Ouvir Testemunha
              </button>
            </div>

            {acusacaoText && (
              <div className="rounded-2xl bg-white/10 p-3 text-xs">
                <div className="font-semibold text-red-300 mb-1">Acusa√ß√£o</div>
                <p className="whitespace-pre-wrap">{typedAcus}</p>
              </div>
            )}
            {defesaText && (
              <div className="rounded-2xl bg-white/10 p-3 text-xs">
                <div className="font-semibold text-emerald-300 mb-1">Defesa</div>
                <p className="whitespace-pre-wrap">{typedDef}</p>
              </div>
            )}

            <div className="rounded-2xl bg-white/10 p-3 text-xs">
              <div className="font-semibold mb-1">Perguntas do Juiz</div>
              <div className="flex gap-2 mb-2">
                <input
                  value={pergunta}
                  onChange={e=>setPergunta(e.target.value)}
                  className="flex-1 rounded-xl bg-white/10 px-3 py-1 outline-none"
                  placeholder="Digite sua pergunta para a testemunha‚Ä¶"
                />
                <button
                  onClick={perguntarIA}
                  className="px-3 py-1 rounded-xl bg-sky-500 hover:bg-sky-600 text-xs font-semibold"
                >
                  Perguntar
                </button>
              </div>
              <div className="space-y-1 max-h-40 overflow-y-auto">
                {falas.map((f,i)=>(
                  <p key={i} className="whitespace-pre-wrap">
                    <span className="font-semibold">
                      {f.autor==="juiz"?"Juiz: ":f.autor==="testemunha"?"Testemunha: ":""}  
                    </span>
                    {f.texto}
                  </p>
                ))}
              </div>
            </div>

            <div className="rounded-2xl bg-white/10 p-3 text-xs">
              <div className="font-semibold mb-1">Veredito</div>
              <div className="flex gap-2">
                <button
                  onClick={()=>decidir(true)}
                  className="flex-1 px-3 py-2 rounded-xl bg-red-600 hover:bg-red-700 text-xs font-semibold"
                >
                  Condenar
                </button>
                <button
                  onClick={()=>decidir(false)}
                  className="flex-1 px-3 py-2 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-xs font-semibold"
                >
                  Absolver
                </button>
              </div>
              <p className="mt-2 text-[10px] opacity-70">
                A simula√ß√£o compara sua decis√£o com um gabarito interno para fins pedag√≥gicos.
                No modo estudo, n√£o h√° impacto em prest√≠gio.
              </p>
            </div>

            <div className="rounded-2xl bg-white/10 p-3 text-xs">
              <div className="flex items-center justify-between mb-2">
                <div className="font-semibold">J√∫ri popular</div>
                <button
                  onClick={simularJuri}
                  className="px-3 py-1 rounded-xl bg-white/15 hover:bg-white/25 text-[11px]"
                >
                  Simular vota√ß√£o do j√∫ri
                </button>
              </div>
              {caso.tipo!=="criminal" && (
                <p className="text-[10px] opacity-75 mb-2">
                  Para fam√≠lia e trabalhista, n√£o h√° j√∫ri popular. Este painel √© apenas ilustrativo.
                </p>
              )}
              <div className="grid grid-cols-4 gap-2">
                {jurados.map((j,idx)=>(
                  <div key={j.id} className="rounded-xl bg-black/40 p-2 flex flex-col items-center text-[10px]">
                    <img
                      src={jurorAvatars[idx]}
                      alt={`Jurador ${j.id}`}
                      className="w-8 h-8 rounded-full mb-1 object-cover border border-white/40"
                    />
                    <div className="opacity-80">J{j.id.toString().padStart(2,"0")}</div>
                    <div className="mt-1">
                      {j.voto===null
                        ? <span className="opacity-60">‚Äî</span>
                        : j.voto
                          ? <span className="text-red-300">Cond.</span>
                          : <span className="text-emerald-300">Absolv.</span>}
                    </div>
                    <div className="text-[9px] opacity-70">
                      {j.certeza? j.certeza+"%" : ""}
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>

          <div className="rounded-2xl bg-white/10 p-3 text-xs">
            <div className="font-semibold mb-2">Provas nos autos</div>
            <div className="space-y-2 max-h-80 overflow-y-auto pr-1">
              {caso.provas.map(p=>(
                <button
                  key={p.id}
                  onClick={()=>setProvaSel(p)}
                  className="w-full text-left rounded-xl bg-black/30 hover:bg-black/40 px-3 py-2"
                >
                  <div className="text-[10px] opacity-70">{p.id} ‚Äî {p.titulo}</div>
                  <div className="text-[11px] line-clamp-2">
                    {p.conteudo.slice(0,110)}{p.conteudo.length>110?"...":""}
                  </div>
                </button>
              ))}
            </div>
          </div>
        </div>

        <p className="mt-4 text-[10px] opacity-70">
          Simula√ß√£o educacional. N√£o substitui aconselhamento jur√≠dico real.
        </p>
      </div>
    </div>
  );
}

// -------- STJ simplificado (placeholder) --------
function STJInfo({onVoltar}){
  return (
    <div className="min-h-screen bg-black text-white flex items-center justify-center">
      <div className="max-w-md w-full mx-4 p-6 rounded-3xl bg-white/10 border border-white/15">
        <h2 className="text-2xl font-bold mb-2">STJ ‚Äî Pr√≥ximo n√≠vel</h2>
        <p className="text-sm opacity-90 mb-3">
          Nesta vers√£o do prot√≥tipo, o modo STJ ainda est√° em constru√ß√£o. A ideia
          √© incluir prova objetiva simulada, vota√ß√£o colegiada e an√°lise de
          precedentes, aproximando o funcionamento das cortes superiores.
        </p>
        <p className="text-xs opacity-80 mb-4">
          Enquanto isso, use o relat√≥rio semestral para estudar seu padr√£o
          decis√≥rio, identificar pontos fortes e escolher quais √°reas deseja
          aprofundar para uma futura promo√ß√£o.
        </p>
        <button
          onClick={onVoltar}
          className="px-5 py-2 rounded-xl bg-emerald-500 hover:bg-emerald-600 text-sm font-semibold"
        >
          Voltar ao escrit√≥rio
        </button>
      </div>
    </div>
  );
}

// ---------------- APP PRINCIPAL ----------------
function App(){
  const [stage,setStage] = useState("splash");
  const [profiles,setProfiles] = useState(()=>{
    try{
      const raw = localStorage.getItem("juiz_profiles");
      return raw ? JSON.parse(raw) : {};
    }catch(e){ return {}; }
  });
  const [currentUser,setCurrentUser] = useState(null);
  const [cases,setCases] = useState(()=>seedCases());
  const [currentCaseId,setCurrentCaseId] = useState(null);
  const [mode,setMode] = useState("carreira"); // carreira | estudo

  const sons = {
    gavel: useSound(SOUND_URLS.gavel,true,0.8),
    murmur: useSound(SOUND_URLS.murmur,true,0.5)
  };

  useEffect(()=>{
    localStorage.setItem("juiz_profiles",JSON.stringify(profiles));
  },[profiles]);

  const currentProfile = currentUser ? profiles[currentUser] : null;

  function updateProfile(p){
    setProfiles(prev=>({
      ...prev,
      [currentUser]:p
    }));
  }

  function handleSelectCase(id){
    setCurrentCaseId(id);
    setStage("julgamento");
  }

  function handleAtualizarCaso(casoAtualizado,acertou,modoAtual){
    setCases(prev=>prev.map(c=>c.id===casoAtualizado.id?casoAtualizado:c));
    if(!currentProfile) return;
    if(modoAtual!=="carreira") return; // no modo estudo n√£o mexe em stats

    const stats = currentProfile.stats || {julgados:0,acertos:0,prestigio:0};
    const julgados = stats.julgados + 1;
    const acertos = stats.acertos + (acertou?1:0);
    const IAJ = julgados ? acertos/julgados : 0;
    const prestigio = Math.min(100,Math.round(IAJ*70 + Math.min(30,julgados/2)));
    updateProfile({...currentProfile,stats:{julgados,acertos,prestigio}});
  }

  // --------- Navega√ß√£o entre telas ---------
  if(stage==="splash")
    return <SplashScreen onStart={()=>setStage("tutorial")} />;

  if(stage==="tutorial")
    return <TutorialSalvamento onContinuar={()=>setStage("login")} />;

  if(stage==="login")
    return (
      <LoginScreen
        profiles={profiles}
        setProfiles={setProfiles}
        setCurrentProfile={setCurrentUser}
        onEnter={()=>setStage("avatar")}
      />
    );

  if(!currentProfile) return null;

  if(stage==="avatar")
    return (
      <AvatarSelectScreen
        profile={currentProfile}
        onSelectAvatar={(avatar)=>{
          updateProfile({...currentProfile,avatar});
          setStage("court");
        }}
      />
    );

  if(stage==="court")
    return (
      <CourtSelectScreen
        onSelectCourt={(court)=>{
          updateProfile({...currentProfile,court});
          setStage("location");
        }}
      />
    );

  if(stage==="location")
    return (
      <LocationSelect
        profile={currentProfile}
        onSelectLocation={(estado,cidade)=>{
          updateProfile({...currentProfile,estado,cidade});
          setStage("escritorio");
        }}
      />
    );

  if(stage==="escritorio")
    return (
      <Escritorio
        profile={currentProfile}
        cases={cases}
        onSelectCase={handleSelectCase}
        sons={sons}
        onSTJ={()=>setStage("stj")}
        onRelatorio={()=>setStage("relatorio")}
        mode={mode}
        setMode={setMode}
      />
    );

  if(stage==="julgamento"){
    const caso = cases.find(c=>c.id===currentCaseId);
    if(!caso) return null;
    return (
      <Julgamento
        caso={caso}
        onAtualizarCaso={handleAtualizarCaso}
        onVoltar={()=>setStage("escritorio")}
        profile={currentProfile}
        sons={sons}
        mode={mode}
      />
    );
  }

  if(stage==="relatorio")
    return (
      <RelatorioSemestral
        profile={currentProfile}
        cases={cases}
        onVoltar={()=>setStage("escritorio")}
      />
    );

  if(stage==="stj")
    return <STJInfo onVoltar={()=>setStage("escritorio")} />;

  return null;
}

const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(<App />);
  </script>
</body>
</html>
