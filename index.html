<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Jogo do Juiz ‚Äî Vale Produ√ß√£o</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/framer-motion/dist/framer-motion.umd.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>html,body,#root{height:100%}</style>
</head>
<body class="bg-black text-white">
  <div id="root"></div>
  <script type="text/babel">
const { useState, useEffect, useMemo, useRef } = React;
const { motion } = window.framerMotion;

// ---------------- DADOS B√ÅSICOS ----------------
const ESTADOS = {
  "AC": ["Rio Branco"],
  "AL": ["Macei√≥"],
  "AP": ["Macap√°"],
  "AM": ["Manaus"],
  "BA": ["Salvador","Feira de Santana","Vit√≥ria da Conquista"],
  "CE": ["Fortaleza"],
  "DF": ["Bras√≠lia"],
  "ES": ["Vit√≥ria"],
  "GO": ["Goi√¢nia"],
  "MA": ["S√£o Lu√≠s"],
  "MT": ["Cuiab√°"],
  "MS": ["Campo Grande"],
  "MG": ["Belo Horizonte","Uberl√¢ndia","Juiz de Fora"],
  "PA": ["Bel√©m"],
  "PB": ["Jo√£o Pessoa"],
  "PR": ["Curitiba","Londrina"],
  "PE": ["Recife"],
  "PI": ["Teresina"],
  "RJ": ["Rio de Janeiro","Niter√≥i"],
  "RN": ["Natal"],
  "RS": ["Porto Alegre","Caxias do Sul"],
  "RO": ["Porto Velho"],
  "RR": ["Boa Vista"],
  "SC": ["Florian√≥polis","Joinville"],
  "SP": ["S√£o Paulo","Campinas","Santos","Sorocaba"],
  "SE": ["Aracaju"],
  "TO": ["Palmas"]
};

const COURT_TYPES = [
  {
    id: "criminal",
    icon: "‚öñÔ∏è",
    title: "Criminal",
    desc: "Crimes contra a pessoa e o patrim√¥nio. J√∫ri popular nos crimes dolosos contra a vida.",
    bgClass: "bg-[url('saladejulgamento.jpg')]"
  },
  {
    id: "familia",
    icon: "üë®‚Äçüë©‚Äçüëß",
    title: "Fam√≠lia",
    desc: "Div√≥rcios, guarda, pens√£o, ado√ß√£o, medidas protetivas e acordos de conviv√™ncia.",
    bgClass: "bg-[url('saladejulgamento.jpg')]"
  },
  {
    id: "trabalhista",
    icon: "üíº",
    title: "Trabalhista",
    desc: "V√≠nculo, verbas rescis√≥rias, horas extras, adicionais, dano moral e acordos.",
    bgClass: "bg-[url('saladejulgamento.jpg')]"
  }
];

const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));

// Sons
const SOUND_URLS = {
  gavel: "https://cdn.pixabay.com/download/audio/2022/03/15/audio_b8e7f6b3a0.mp3?filename=judge-gavel-182004.mp3",
  ambience: "https://cdn.pixabay.com/download/audio/2022/10/25/audio_6d02f9f2c3.mp3?filename=large-room-ambience-124106.mp3",
  murmur: "https://cdn.pixabay.com/download/audio/2021/09/16/audio_7b4b2d7f6c.mp3?filename=crowd-murmur-ambient-75537.mp3",
};

function useSound(url,enabled=true,volume=0.7){
  const ref = useRef(null);
  useEffect(()=>{
    const a = new Audio(url);
    a.volume = volume;
    ref.current = a;
    return ()=>{ a.pause(); ref.current=null; };
  },[url]);
  const play = ()=>{ if(enabled && ref.current){ ref.current.currentTime=0; ref.current.play(); } };
  const stop = ()=>{ if(ref.current){ ref.current.pause(); ref.current.currentTime=0; } };
  return { play, stop };
}

// ---------------- TYPEWRITER ----------------
function useTypewriter(fullText, speed = 18, play = true) {
  const [text, setText] = useState("");
  useEffect(() => {
    if (!play) return setText(fullText);
    setText("");
    let i = 0;
    const id = setInterval(() => {
      i++;
      setText(fullText.slice(0, i));
      if (i >= fullText.length) clearInterval(id);
    }, speed);
    return () => clearInterval(id);
  }, [fullText, speed, play]);
  return text;
}

// ---------------- CASOS (simplificados) ----------------
function seedCases(){
  const casos = [];
  const add = (tipo,titulo,resumo,provas,gabarito)=>{
    casos.push({
      id: `${tipo}-${casos.length+1}`,
      tipo,
      titulo,
      resumo,
      provas,
      gabarito,
      status: "na_fila"
    });
  };

  // Alguns exemplos por ramo (padr√£o ‚Äî pode ser expandido depois)
  add("criminal",
    "Homic√≠dio simples em bar",
    "Discuss√£o que terminou com morte. R√©u alega leg√≠tima defesa.",
    [
      {id:"E1",tipo:"boletim",conteudo:"BO descreve briga generalizada em bar."},
      {id:"E2",tipo:"laudo",conteudo:"Laudo necrosc√≥pico confirma ferimento √∫nico por faca."},
      {id:"E3",tipo:"testemunha",conteudo:"Testemunha afirma que v√≠tima iniciou agress√£o f√≠sica."}
    ],
    {culpado:true,padrao:"alem_duvida"}
  );

  add("criminal",
    "Roubo com simulacro de arma",
    "V√≠tima relata amea√ßa com arma. Apreens√£o encontra simulacro.",
    [
      {id:"E1",tipo:"reconhecimento",conteudo:"V√≠tima reconhece o r√©u por tatuagem no pesco√ßo."},
      {id:"E2",tipo:"apreensao",conteudo:"Objetos da v√≠tima encontrados na mochila do r√©u."},
      {id:"E3",tipo:"pericia",conteudo:"Simulacro incapaz de disparar proj√©teis."}
    ],
    {culpado:true,padrao:"alem_duvida"}
  );

  add("familia",
    "Guarda compartilhada com resid√™ncia fixa",
    "Pais concordam com guarda, divergem sobre resid√™ncia principal.",
    [
      {id:"E1",tipo:"relatorio",conteudo:"Assistente social aponta rotina mais est√°vel na casa da m√£e."},
      {id:"E2",tipo:"escola",conteudo:"Boletim indica bom desempenho e adapta√ß√£o na escola atual."}
    ],
    {culpado:false,padrao:"preponderancia"}
  );

  add("trabalhista",
    "Horas extras habituais e banco de horas",
    "Empregado alega 2h extras di√°rias sem pagamento adequado.",
    [
      {id:"E1",tipo:"ponto",conteudo:"Registros com entradas e sa√≠das sempre no mesmo hor√°rio."},
      {id:"E2",tipo:"testemunha",conteudo:"Colega afirma que todos permaneciam al√©m da jornada."}
    ],
    {culpado:false,padrao:"preponderancia"}
  );

  // Duplicar de forma variada s√≥ para ter volume (prot√≥tipo)
  const base = [...casos];
  while(casos.length < 60){
    const c = base[casos.length % base.length];
    casos.push({...c, id: `${c.tipo}-${casos.length+1}`});
  }
  return casos;
}

// ---------------- IA LOCAL SIMULADA ----------------
async function iaFala(agente, caso, pergunta="") {
  const provasTxt = caso.provas.map(p=>`[${p.id}] ${p.tipo}: ${p.conteudo}`).join(" | ");
  let foco;
  if(pergunta){
    const lower = pergunta.toLowerCase();
    if(lower.includes("laudo")||lower.includes("per√≠cia")) foco = "laudo";
    else if(lower.includes("testemunh")) foco = "testemunhas";
    else if(lower.includes("boletim")||lower.includes("b.o")) foco = "boletim";
    else if(lower.includes("d√∫vida")||lower.includes("duvida")) foco = "duvida";
    else foco = "geral";
  } else {
    foco = "geral";
  }

  let textoBase = "";
  if(agente==="acusacao"){
    if(caso.tipo==="criminal"){
      if(foco==="duvida") textoBase = "A prova √© coesa e supera o patamar da d√∫vida razo√°vel.";
      else textoBase = "A acusa√ß√£o destaca a harmonia entre depoimentos, laudos e demais documentos.";
    } else {
      textoBase = "A parte autora se desincumbiu do √¥nus probat√≥rio, segundo a acusa√ß√£o.";
    }
  } else if(agente==="defesa"){
    if(caso.tipo==="criminal"){
      if(foco==="duvida") textoBase = "A defesa insiste que subsiste d√∫vida relevante sobre a din√¢mica dos fatos.";
      else textoBase = "A defesa aponta contradi√ß√µes e lacunas que enfraquecem a tese acusat√≥ria.";
    } else {
      textoBase = "A defesa sustenta que a vers√£o do r√©u √© mais veross√≠mil diante do conjunto probat√≥rio.";
    }
  } else {
    textoBase = "A testemunha busca esclarecer pontos espec√≠ficos, sem assumir posi√ß√£o quanto ao m√©rito.";
  }

  const intro = agente==="acusacao" ? "ACUSA√á√ÉO" : agente==="defesa" ? "DEFESA" : "TESTEMUNHA";
  const respostaPergunta = pergunta
    ? `Sobre a pergunta do Juiz: "${pergunta}", o foco recai principalmente em ${foco}. `
    : "";

  const texto = `${intro} ‚Äî exposi√ß√£o inicial: ${respostaPergunta}${textoBase}
Principais elementos destacados: ${provasTxt}.`;

  await new Promise(r=>setTimeout(r,400+Math.random()*600));
  return texto;
}

// ---------------- COMPONENTES ----------------
function SplashScreen({onStart}) {
  return (
    <div className="min-h-screen bg-black text-white flex items-center justify-center">
      <div className="relative w-full h-full max-w-md mx-auto">
        <div className="absolute inset-0 bg-[url('capa.jpg')] bg-cover bg-center opacity-60" />
        <div className="relative z-10 h-full flex flex-col items-center justify-end pb-16 px-4 bg-gradient-to-t from-black via-black/60 to-transparent">
          <h1 className="text-4xl font-bold mb-2 drop-shadow-lg text-center">Tribunal</h1>
          <p className="text-lg mb-6 drop-shadow text-center">Simulador de Juiz</p>
          <button
            onClick={onStart}
            className="px-6 py-3 rounded-2xl bg-emerald-500 hover:bg-emerald-600 font-semibold shadow-xl">
            Iniciar
          </button>
        </div>
      </div>
    </div>
  );
}

function TutorialSalvamento({onContinuar}) {
  return (
    <div className="min-h-screen bg-gradient-to-b from-slate-950 via-slate-900 to-black flex items-center justify-center text-white">
      <div className="max-w-xl mx-auto p-6 rounded-3xl bg-white/5 backdrop-blur shadow-2xl border border-white/10">
        <h2 className="text-2xl font-bold mb-4">Como funciona o salvamento</h2>
        <ol className="list-decimal pl-5 space-y-2 text-sm text-slate-200">
          <li>Ao avan√ßar no jogo, suas decis√µes ficam guardadas no navegador.</li>
          <li>Use o bot√£o <b>Salvar agora</b> para gerar um arquivo <code>.juizsave</code>.</li>
          <li>Guarde esse arquivo no seu computador ou celular.</li>
          <li>No futuro, use <b>Importar save</b> na tela inicial para continuar exatamente de onde parou.</li>
        </ol>
        <p className="mt-4 text-xs text-slate-300">
          Dica: voc√™ pode ter v√°rios perfis (por exemplo: modo carreira e modo estudo) com saves diferentes.
        </p>
        <button
          onClick={onContinuar}
          className="mt-6 px-5 py-2 rounded-2xl bg-emerald-500 hover:bg-emerald-600 text-sm font-semibold">
          Entendi, continuar
        </button>
      </div>
    </div>
  );
}

function LoginScreen({profiles,setProfiles,setCurrentProfile,onEnter}) {
  const [user,setUser] = useState("");
  const [file,setFile] = useState(null);

  function handleEnter(){
    if(!user.trim()) return;
    if(!profiles[user]){
      profiles = {...profiles,[user]:{
        nome:user,
        modo:"carreira",
        stats:{julgados:0,acertos:0,prestigio:0,semestres:[]},
        court:null,
        estado:"SP",
        cidade:"S√£o Paulo"
      }};
      setProfiles(profiles);
      localStorage.setItem("juiz_profiles",JSON.stringify(profiles));
    }
    setCurrentProfile(user);
    onEnter();
  }

  function handleImport(){
    if(!file) return;
    const reader = new FileReader();
    reader.onload = e=>{
      try{
        const data = JSON.parse(e.target.result);
        setProfiles(data);
        localStorage.setItem("juiz_profiles",JSON.stringify(data));
        alert("Save importado com sucesso!");
      }catch(err){
        alert("Arquivo inv√°lido.");
      }
    };
    reader.readAsText(file);
  }

  function handleExport(){
    const blob = new Blob([JSON.stringify(profiles,null,2)],{type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href=url;
    a.download="tribunal_juizsave.json";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  return (
    <div className="min-h-screen bg-[url('capa.jpg')] bg-cover bg-center flex items-center justify-center">
      <div className="bg-black/70 text-white max-w-lg w-full mx-4 p-6 rounded-3xl shadow-2xl border border-white/10">
        <h1 className="text-xl font-semibold mb-1 text-center">Vale Produ√ß√£o apresenta</h1>
        <h2 className="text-3xl font-bold text-center mb-4">Jogo do Juiz 6.1</h2>
        <p className="text-xs text-center mb-4 opacity-80">
          Entre com seu usu√°rio. Crie um novo ou importe um save existente.
        </p>
        <div className="space-y-3">
          <div>
            <label className="text-xs opacity-80">Usu√°rio</label>
            <input
              className="w-full mt-1 px-3 py-2 rounded-xl bg-white/10 outline-none text-sm"
              value={user}
              onChange={e=>setUser(e.target.value)}
              placeholder="Ex.: DraMaria, EstudanteJo√£o..."
            />
          </div>
          <div className="flex gap-2">
            <button
              onClick={handleEnter}
              className="flex-1 px-3 py-2 rounded-xl bg-emerald-500 hover:bg-emerald-600 text-sm font-semibold">
              Entrar / Criar perfil
            </button>
            <button
              onClick={handleExport}
              className="px-3 py-2 rounded-xl bg-white/10 hover:bg-white/20 text-xs">
              Exportar save
            </button>
          </div>
          <div className="mt-2 text-xs">
            <div className="mb-1">Importar save:</div>
            <input
              type="file"
              accept=".json,.juizsave"
              onChange={e=>setFile(e.target.files[0]||null)}
              className="text-xs"
            />
            <button
              onClick={handleImport}
              className="ml-2 px-3 py-1 rounded-xl bg-sky-500 hover:bg-sky-600 text-xs align-middle">
              Importar
            </button>
          </div>
        </div>
        {Object.keys(profiles).length>0 && (
          <div className="mt-4">
            <div className="text-xs mb-1 opacity-70">Perfis encontrados:</div>
            <div className="flex flex-wrap gap-2">
              {Object.keys(profiles).map(p=>(
                <button
                  key={p}
                  onClick={()=>{setUser(p);}}
                  className="px-3 py-1 rounded-full bg-white/10 hover:bg-white/20 text-xs">
                  {p}
                </button>
              ))}
            </div>
          </div>
        )}
      </div>
    </div>
  );
} function CourtSelectScreen({onSelectCourt}) {
  return (
    <div className="min-h-screen bg-black text-white flex items-center justify-center">
      <div className="max-w-5xl w-full p-6">
        <h2 className="text-3xl font-bold mb-6 text-center">Escolha o Tribunal</h2>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
          {COURT_TYPES.map(court=>(
            <motion.div
              whileHover={{scale:1.03}}
              key={court.id}
              onClick={()=>onSelectCourt(court.id)}
              className="cursor-pointer p-6 rounded-3xl bg-white/10 backdrop-blur border border-white/10 shadow-xl"
            >
              <div className="text-4xl mb-3">{court.icon}</div>
              <h3 className="text-2xl font-bold mb-2">{court.title}</h3>
              <p className="text-sm opacity-80">{court.desc}</p>
            </motion.div>
          ))}
        </div>
      </div>
    </div>
  );
}

function LocationSelect({profile,onSelectLocation}) {
  const [estado,setEstado] = useState(profile.estado||"SP");
  const cidades = ESTADOS[estado] || [];
  const [cidade,setCidade] = useState(profile.cidade||cidades[0]);

  return (
    <div className="min-h-screen bg-black text-white flex items-center justify-center">
      <div className="bg-white/10 p-6 rounded-3xl max-w-md w-full backdrop-blur border border-white/10">
        <h2 className="text-2xl font-bold mb-4">Escolha a Comarca</h2>
        <div className="mb-4">
          <label className="text-xs opacity-80">Estado</label>
          <select
            value={estado}
            onChange={e=>{
              setEstado(e.target.value);
              setCidade(ESTADOS[e.target.value][0]);
            }}
            className="w-full mt-1 px-3 py-2 bg-white/10 rounded-xl outline-none text-sm"
          >
            {Object.keys(ESTADOS).map(uf=>(
              <option key={uf} value={uf}>{uf}</option>
            ))}
          </select>
        </div>

        <div>
          <label className="text-xs opacity-80">Cidade</label>
          <select
            value={cidade}
            onChange={e=>setCidade(e.target.value)}
            className="w-full mt-1 px-3 py-2 bg-white/10 rounded-xl outline-none text-sm"
          >
            {cidades.map(c=>(
              <option key={c} value={c}>{c}</option>
            ))}
          </select>
        </div>

        <button
          onClick={()=>onSelectLocation(estado,cidade)}
          className="mt-5 w-full px-4 py-2 rounded-xl bg-emerald-500 hover:bg-emerald-600 font-semibold"
        >
          Confirmar Comarca
        </button>
      </div>
    </div>
  );
}

function Escritorio({profile,cases,onSelectCase,onSTJ,onRelatorio,sons}) {
  const julgados = cases.filter(c=>c.status!=="na_fila");
  const fila = cases.filter(c=>c.status==="na_fila");

  return (
    <div className="min-h-screen relative bg-[url('escritorio.jpg')] bg-cover bg-center text-white">
      <div className="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>

      <div className="relative z-10 max-w-6xl mx-auto p-6">
        <h1 className="text-3xl font-bold">Escrit√≥rio do Juiz</h1>
        <p className="text-sm opacity-80 mb-6">
          {profile.nome} ‚Äî {profile.cidade}/{profile.estado}
        </p>

        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div className="bg-white/10 p-6 rounded-3xl border border-white/10">
            <h2 className="text-xl font-semibold mb-3">Fila de Processos</h2>
            <div className="max-h-96 overflow-y-auto pr-2 space-y-3">
              {fila.map(c=>(
                <div key={c.id} className="p-4 bg-white/5 rounded-xl border border-white/5">
                  <h3 className="font-semibold">{c.titulo}</h3>
                  <p className="text-xs opacity-70 mb-3">{c.resumo}</p>
                  <button
                    onClick={()=>{sons.gavel.play(); onSelectCase(c.id);}}
                    className="px-4 py-1 bg-emerald-500 hover:bg-emerald-600 text-sm rounded-lg"
                  >
                    Julgar
                  </button>
                </div>
              ))}
            </div>
          </div>

          <div className="bg-white/10 p-6 rounded-3xl border border-white/10">
            <h2 className="text-xl font-semibold mb-3">Estat√≠sticas</h2>
            <p className="text-sm">Julgados: {julgados.length}</p>
            <p className="text-sm">Acertos: {profile.stats.acertos}</p>
            <p className="text-sm">Prest√≠gio: {profile.stats.prestigio || 0}</p>

            <button
              onClick={onRelatorio}
              className="mt-4 w-full px-4 py-2 rounded-xl bg-sky-500 hover:bg-sky-600 text-sm"
            >
              Relat√≥rio Semestral
            </button>

            {profile.stats.prestigio >= 40 && (
              <button
                onClick={onSTJ}
                className="mt-3 w-full px-4 py-2 rounded-xl bg-yellow-500 hover:bg-yellow-600 text-sm font-bold"
              >
                Candidatar-se ao STJ
              </button>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}

function ProvaViewer({prova,onClose}) {
  if(!prova) return null;
  return (
    <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50">
      <div className="bg-white/10 text-white p-6 rounded-3xl max-w-lg w-full backdrop-blur border border-white/10">
        <h2 className="text-xl font-bold mb-4">{prova.id} ‚Äî {prova.tipo}</h2>
        <p className="text-sm opacity-90 mb-6 whitespace-pre-wrap">{prova.conteudo}</p>
        <button
          onClick={onClose}
          className="px-4 py-2 rounded-xl bg-red-500 hover:bg-red-600"
        >
          Fechar
        </button>
      </div>
    </div>
  );
}
function Julgamento({
  caso, setCaso, onVoltar, profile, sons
}) {
  const [falas,setFalas] = useState([]);
  const [pergunta,setPergunta] = useState("");
  const [provaSel,setProvaSel] = useState(null);

  async function ouvir(ag){
    const fala = await iaFala(ag,caso,"");
    setFalas(f=>[...f,{autor:ag,texto:fala}]);
    sons.murmur.play();
  }

  async function perguntarIA(){
    if(!pergunta.trim()) return;
    const fala = await iaFala("testemunha",caso,pergunta);
    setFalas(f=>[
      ...f,
      {autor:"juiz",texto:`Pergunta: ${pergunta}`},
      {autor:"testemunha",texto:fala}
    ]);
    setPergunta("");
    sons.murmur.play();
  }

  function decidir(veredito){
    const acertou = veredito===caso.gabarito.culpado;
    const novoStatus = veredito ? "condenado" : "absolvido";
    const atualizado = {...caso,status:novoStatus};
    setCaso(atualizado);
    alert(acertou ? "Decis√£o correta!" : "Decis√£o incorreta.");
    onVoltar();
  }

  return (
    <div className="min-h-screen relative bg-[url('saladejulgamento.jpg')] bg-cover bg-center text-white">
      <div className="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>

      <ProvaViewer prova={provaSel} onClose={()=>setProvaSel(null)} />

      <div className="relative z-10 max-w-5xl mx-auto p-6">
        <button onClick={onVoltar} className="mb-4 px-3 py-1 bg-white/10 rounded-xl text-xs">Voltar</button>
        <h1 className="text-3xl font-bold mb-2">{caso.titulo}</h1>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <div className="lg:col-span-2 space-y-3">
            <div className="space-x-2 mb-3">
              <button
                onClick={()=>ouvir("acusacao")}
                className="px-3 py-1 bg-red-500/80 hover:bg-red-600 rounded-xl text-sm"
              >
                Ouvir Acusa√ß√£o
              </button>
              <button
                onClick={()=>ouvir("defesa")}
                className="px-3 py-1 bg-blue-500/80 hover:bg-blue-600 rounded-xl text-sm"
              >
                Ouvir Defesa
              </button>
            </div>

            <div className="max-h-80 overflow-y-auto space-y-3 pr-2">
              {falas.map((f,i)=>(
                <motion.div
                  initial={{opacity:0,y:10}}
                  animate={{opacity:1,y:0}}
                  key={i}
                  className="bg-white/10 p-3 rounded-xl border border-white/10"
                >
                  <p className="text-xs mb-1 opacity-70">
                    {f.autor==="acusacao"?"Acusa√ß√£o":
                     f.autor==="defesa"?"Defesa":
                     f.autor==="juiz"?"Juiz":
                     "Testemunha"}
                  </p>
                  <p className="text-sm whitespace-pre-wrap">{f.texto}</p>
                </motion.div>
              ))}
            </div>

            <div className="flex gap-2 mt-4">
              <input
                value={pergunta}
                onChange={e=>setPergunta(e.target.value)}
                placeholder="Pergunta do juiz..."
                className="flex-1 px-3 py-2 bg-white/10 rounded-xl outline-none text-sm"
              />
              <button
                onClick={perguntarIA}
                className="px-4 py-2 rounded-xl bg-emerald-500 hover:bg-emerald-600 text-sm"
              >
                Perguntar
              </button>
            </div>

            <div className="flex gap-2 mt-4">
              <button
                onClick={()=>decidir(true)}
                className="px-4 py-2 rounded-xl bg-red-500 hover:bg-red-600 text-sm"
              >
                Condenar
              </button>
              <button
                onClick={()=>decidir(false)}
                className="px-4 py-2 rounded-xl bg-blue-500 hover:bg-blue-600 text-sm"
              >
                Absolver
              </button>
            </div>
          </div>

          <div className="bg-white/10 p-4 rounded-3xl border border-white/10 max-h-96 overflow-y-auto">
            <h2 className="text-lg font-semibold mb-2">Provas</h2>
            {caso.provas.map(p=>(
              <div
                key={p.id}
                onClick={()=>setProvaSel(p)}
                className="mb-2 px-3 py-2 bg-white/5 rounded-xl cursor-pointer hover:bg-white/10 text-sm"
              >
                {p.id} ‚Äî {p.tipo}
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
}

// ---------------- APP PRINCIPAL ----------------
function App(){
  const [screen,setScreen] = useState("splash");
  const [profiles,setProfiles] = useState(()=>{
    try{
      const raw = localStorage.getItem("juiz_profiles");
      return raw ? JSON.parse(raw) : {};
    }catch(e){
      return {};
    }
  });
  const [currentProfileId,setCurrentProfileId] = useState(null);
  const [cases,setCases] = useState(()=>seedCases());
  const [currentCase,setCurrentCase] = useState(null);

  const sons = {
    gavel: useSound(SOUND_URLS.gavel,true,0.8),
    murmur: useSound(SOUND_URLS.murmur,true,0.4),
  };

  useEffect(()=>{
    try{
      localStorage.setItem("juiz_profiles",JSON.stringify(profiles));
    }catch(e){}
  },[profiles]);

  const currentProfile = currentProfileId ? profiles[currentProfileId] : null;

  function handleEnterProfiles(){
    setScreen("court");
  }

  function handleSelectCourt(courtId){
    if(!currentProfile) return;
    const updated = {...currentProfile, court: courtId};
    setProfiles(prev=>({...prev,[currentProfileId]:updated}));
    setScreen("location");
  }

  function handleLocationSelect(estado,cidade){
    if(!currentProfile) return;
    const updated = {...currentProfile, estado, cidade};
    setProfiles(prev=>({...prev,[currentProfileId]:updated}));
    setScreen("office");
  }

  function handleSelectCase(caseId){
    const c = cases.find(x=>x.id===caseId);
    if(!c) return;
    setCurrentCase(c);
    setScreen("trial");
  }

  function handleUpdateCase(updatedCase){
    setCases(prev=>prev.map(c=>c.id===updatedCase.id ? updatedCase : c));
    setCurrentCase(updatedCase);
    if(currentProfileId){
      const prof = profiles[currentProfileId];
      const julgados = (prof.stats?.julgados || 0) + 1;
      const acertos = (prof.stats?.acertos || 0)
        + (updatedCase.status === (updatedCase.gabarito.culpado ? "condenado" : "absolvido") ? 1 : 0);
      const prestigio = Math.min(100, Math.round((acertos/(julgados||1))*80));
      const newStats = { ...(prof.stats||{}), julgados, acertos, prestigio };
      setProfiles(prev=>({...prev,[currentProfileId]:{...prof,stats:newStats}}));
    }
  }

  function handleBackToOffice(){
    setScreen("office");
  }

  function handleRelatorio(){
    setScreen("relatorio");
  }

  function handleSTJ(){
    setScreen("stj");
  }

  function handlePromoverSTJ(){
    if(!currentProfileId) return;
    const prof = profiles[currentProfileId];
    const updated = {...prof, court: "stj"};
    setProfiles(prev=>({...prev,[currentProfileId]:updated}));
    setScreen("office");
  }

  if(screen === "splash"){
    return <SplashScreen onStart={()=>setScreen("tutorial")} />;
  }

  if(screen === "tutorial"){
    return <TutorialSalvamento onContinuar={()=>setScreen("login")} />;
  }

  if(screen === "login"){
    return (
      <LoginScreen
        profiles={profiles}
        setProfiles={setProfiles}
        setCurrentProfile={setCurrentProfileId}
        onEnter={handleEnterProfiles}
      />
    );
  }

  if(!currentProfile){
    return (
      <div className="min-h-screen bg-black text-white flex items-center justify-center">
        <div className="text-center">
          <p className="mb-4">Nenhum perfil selecionado.</p>
          <button
            onClick={()=>setScreen("login")}
            className="px-4 py-2 bg-emerald-500 rounded-xl"
          >
            Voltar ao login
          </button>
        </div>
      </div>
    );
  }

  if(screen === "court"){
    return <CourtSelectScreen onSelectCourt={handleSelectCourt} />;
  }

  if(screen === "location"){
    return (
      <LocationSelect
        profile={currentProfile}
        onSelectLocation={handleLocationSelect}
      />
    );
  }

  if(screen === "office"){
    const filteredCases = cases.filter(c=>c.tipo === (currentProfile.court || "criminal"));
    return (
      <Escritorio
        profile={currentProfile}
        cases={filteredCases}
        onSelectCase={handleSelectCase}
        onSTJ={handleSTJ}
        onRelatorio={handleRelatorio}
        sons={sons}
      />
    );
  }

  if(screen === "trial" && currentCase){
    return (
      <Julgamento
        caso={currentCase}
        setCaso={handleUpdateCase}
        onVoltar={handleBackToOffice}
        profile={currentProfile}
        sons={sons}
      />
    );
  }

  if(screen === "relatorio"){
    return (
      <RelatorioScreen
        profile={currentProfile}
        cases={cases.filter(c=>c.tipo===(currentProfile.court||"criminal"))}
        onVoltar={handleBackToOffice}
      />
    );
  }

  if(screen === "stj"){
    return (
      <STJScreen
        profile={currentProfile}
        onPromover={handlePromoverSTJ}
        onVoltar={handleBackToOffice}
      />
    );
  }

  return (
    <div className="min-h-screen bg-black text-white flex items-center justify-center">
      <button
        onClick={()=>setScreen("splash")}
        className="px-4 py-2 rounded-xl bg-emerald-500"
      >
        Reiniciar jogo
      </button>
    </div>
  );
}

// ---------------- RELAT√ìRIO E STJ ----------------
function RelatorioScreen({profile,onVoltar,cases}) {
  const julgados = cases.filter(c=>c.status!=="na_fila");
  const acertos = profile.stats.acertos || 0;
  const prestigio = profile.stats.prestigio || 0;

  return (
    <div className="min-h-screen bg-black text-white flex items-center justify-center p-6">
      <div className="bg-white/10 backdrop-blur p-6 rounded-3xl border border-white/10 max-w-2xl w-full">
        <h1 className="text-3xl font-bold mb-4">Relat√≥rio Semestral</h1>

        <p className="text-sm opacity-80 mb-4">
          Juiz: {profile.nome}<br/>
          Comarca: {profile.cidade}/{profile.estado}<br/>
          Tribunal: {profile.court}
        </p>

        <div className="space-y-3 text-sm">
          <p>Casos julgados: {julgados.length}</p>
          <p>Acertos: {acertos}</p>
          <p>Prest√≠gio acumulado: {prestigio}</p>
        </div>

        <button
          onClick={onVoltar}
          className="mt-6 w-full px-4 py-2 rounded-xl bg-emerald-500 hover:bg-emerald-600"
        >
          Voltar
        </button>
      </div>
    </div>
  );
}

function STJScreen({profile,onPromover,onVoltar}) {
  return (
    <div className="min-h-screen bg-[url('stj.jpg')] bg-cover bg-center relative text-white">
      <div className="absolute inset-0 bg-black/70 backdrop-blur-sm"></div>
      <div className="relative z-10 max-w-xl mx-auto p-6 text-center">
        <h1 className="text-3xl font-bold mb-4">Tribunal Superior</h1>
        <p className="text-sm opacity-80 mb-4">
          Sua reputa√ß√£o chamou aten√ß√£o. Voc√™ foi convidado a integrar o STJ.
        </p>

        <button
          onClick={onPromover}
          className="w-full px-4 py-2 bg-yellow-500 hover:bg-yellow-600 rounded-xl mb-3"
        >
          Aceitar Promo√ß√£o
        </button>

        <button
          onClick={onVoltar}
          className="w-full px-4 py-2 bg-white/10 hover:bg-white/20 rounded-xl"
        >
          Recusar
        </button>
      </div>
    </div>
  );
}

const ROOT = ReactDOM.createRoot(document.getElementById("root"));
ROOT.render(<App/>);
